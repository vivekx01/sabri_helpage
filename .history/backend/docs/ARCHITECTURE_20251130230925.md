# ğŸ—ï¸ Sabri Helpage Admin Panel - Complete Architecture

## ğŸ“ Project Structure

```
backend/
â”œâ”€â”€ components/                # AdminJS Custom Components
â”‚   â”œâ”€â”€ dashboard.jsx          # Enhanced dashboard with stats & role badges
â”‚   â””â”€â”€ StatusBadge.jsx        # Custom status badge component
â”‚
â”œâ”€â”€ config/                    # Configuration Files
â”‚   â”œâ”€â”€ db.js                  # MongoDB connection
â”‚   â””â”€â”€ adminConfig.js         # Complete AdminJS configuration
â”‚
â”œâ”€â”€ controllers/               # Business Logic
â”‚   â””â”€â”€ universalController.js # Universal CRUD + Approval controller
â”‚
â”œâ”€â”€ middleware/                # Middleware Functions
â”‚   â”œâ”€â”€ authMiddleware.js      # JWT authentication
â”‚   â”œâ”€â”€ rbac.js                # Role-Based Access Control
â”‚   â””â”€â”€ errorMiddleware.js     # Error handling
â”‚
â”œâ”€â”€ models/                    # Mongoose Models (15 total)
â”‚   â”œâ”€â”€ User.js                # Admin users with roles
â”‚   â”œâ”€â”€ Blog.js                # Blog posts with status
â”‚   â”œâ”€â”€ Story.js               # Success stories
â”‚   â”œâ”€â”€ Event.js               # Events (year/month organized)
â”‚   â”œâ”€â”€ Video.js               # Video uploads
â”‚   â”œâ”€â”€ Award.js               # Awards & recognitions
â”‚   â”œâ”€â”€ Publication.js         # Publications & reports
â”‚   â”œâ”€â”€ Faq.js                 # FAQs
â”‚   â”œâ”€â”€ Teacher.js             # Team members/staff
â”‚   â”œâ”€â”€ Contact.js             # Contact inquiries
â”‚   â”œâ”€â”€ Donor.js               # Donor information
â”‚   â”œâ”€â”€ Volunteer.js           # Volunteer applications
â”‚   â”œâ”€â”€ Internship.js          # Internship applications
â”‚   â”œâ”€â”€ ClubRegistration.js    # Club registrations
â”‚   â”œâ”€â”€ SiteConfig.js          # Site settings (logo, hero images)
â”‚   â””â”€â”€ CSRSubmission.js       # CSR proposals
â”‚
â”œâ”€â”€ routes/                    # API Routes
â”‚   â”œâ”€â”€ authRoutes.js          # Authentication endpoints
â”‚   â”œâ”€â”€ userRoutes.js          # User management
â”‚   â”œâ”€â”€ blogRoutes.js          # Blog CRUD + approval
â”‚   â”œâ”€â”€ storyRoutes.js         # Stories CRUD + approval
â”‚   â”œâ”€â”€ eventRoutes.js         # Events CRUD + approval
â”‚   â”œâ”€â”€ videoRoutes.js         # Videos CRUD + approval
â”‚   â”œâ”€â”€ awardRoutes.js         # Awards CRUD + approval
â”‚   â”œâ”€â”€ publicationRoutes.js   # Publications CRUD + approval
â”‚   â”œâ”€â”€ faqRoutes.js           # FAQs management
â”‚   â”œâ”€â”€ teacherRoutes.js       # Team management
â”‚   â”œâ”€â”€ contactRoutes.js       # Contact inquiries
â”‚   â”œâ”€â”€ donorRoutes.js         # Donor management
â”‚   â”œâ”€â”€ volunteerRoutes.js     # Volunteer applications
â”‚   â”œâ”€â”€ internshipRoutes.js    # Internship applications
â”‚   â”œâ”€â”€ clubRoutes.js          # Club registrations
â”‚   â”œâ”€â”€ configRoutes.js        # Site configuration
â”‚   â”œâ”€â”€ csrRoutes.js           # CSR submissions
â”‚   â””â”€â”€ uploadRoutes.js        # File uploads
â”‚
â”œâ”€â”€ scripts/                   # Utility Scripts
â”‚   â””â”€â”€ createAdminUsers.js    # Seed admin users
â”‚
â”œâ”€â”€ utils/                     # Utility Functions
â”‚   â”œâ”€â”€ cloudinaryUpload.js    # File upload handler
â”‚   â””â”€â”€ routeFactory.js        # Universal route generator
â”‚
â”œâ”€â”€ docs/                      # Documentation
â”‚   â”œâ”€â”€ API_DOCUMENTATION.md   # Complete API docs
â”‚   â””â”€â”€ ARCHITECTURE.md        # This file
â”‚
â”œâ”€â”€ .env                       # Environment variables
â”œâ”€â”€ server.js                  # Main application entry
â””â”€â”€ package.json               # Dependencies
```

---

## ğŸ¨ Design Patterns Used

### 1. **Factory Pattern**
- `createUniversalController()` - Creates consistent controllers
- `createResourceRoutes()` - Generates standard REST routes
- `createUploadMiddleware()` - Configures file uploads

### 2. **Strategy Pattern**
- Role-based access control with permission strategies
- Different upload strategies for images/videos/documents

### 3. **Middleware Chain Pattern**
- Authentication â†’ Authorization â†’ Business Logic â†’ Error Handling

### 4. **Repository Pattern**
- Universal controller abstracts database operations
- Consistent interface for all models

---

## ğŸ” Role-Based Access Control (RBAC)

### Permission Matrix

| Resource              | Super Admin | Admin | Manager | Editor |
|-----------------------|-------------|-------|---------|--------|
| **Users**             |
| Create/Edit/Delete    | âœ…          | âœ…    | âŒ      | âŒ     |
| **Donors**            |
| View                  | âœ…          | âœ…    | âœ…      | âŒ     |
| Create/Edit/Approve   | âœ…          | âœ…    | âœ…      | âŒ     |
| Delete                | âœ…          | âœ…    | âœ…      | âŒ     |
| **Registrations**     |
| View                  | âœ…          | âœ…    | âœ…      | âœ…     |
| Create/Edit           | âœ…          | âœ…    | âœ…      | âŒ     |
| Approve/Reject        | âœ…          | âœ…    | âœ…      | âŒ     |
| Delete                | âœ…          | âœ…    | âœ…      | âŒ     |
| **Content**           |
| View                  | âœ…          | âœ…    | âœ…      | âœ…     |
| Create/Edit           | âœ…          | âœ…    | âœ…      | âœ…     |
| Publish               | âœ…          | âœ…    | âœ…      | âŒ     |
| Delete                | âœ…          | âœ…    | âœ…      | âŒ     |
| **Contacts**          |
| View/Manage           | âœ…          | âœ…    | âœ…      | âŒ     |
| **Site Config**       |
| View/Edit             | âœ…          | âœ…    | âŒ      | âŒ     |
| **System Logs**       |
| View                  | âœ…          | âŒ    | âŒ      | âŒ     |

---

## ğŸ“Š Status Workflows

### Content Status Flow
```
draft â†’ published â†’ archived
```

### Registration Status Flow
```
pending â†’ approved/rejected â†’ archived
```

### CSR Submission Flow
```
pending â†’ under-review â†’ approved/rejected â†’ archived
```

### Contact Status Flow
```
new â†’ read â†’ replied â†’ archived
```

---

## ğŸ¯ Key Features Implemented

### âœ… Complete CRUD Operations
- Create, Read, Update, Delete for all resources
- Consistent API patterns across all endpoints
- Validation and error handling

### âœ… Approval System
- Approve/Reject workflows
- Review notes tracking
- Reviewer information logging
- Timestamp tracking

### âœ… Bulk Operations
- Bulk approve (Admin+)
- Bulk archive (Admin+)
- Bulk delete (Super Admin only)

### âœ… File Management
- Cloudinary integration
- Multiple file type support
- Size validation
- Auto-optimization
- Organized folder structure

### âœ… Search & Filter
- Full-text search across fields
- Status filtering
- Date range filtering
- Year/month filtering (events)
- Pagination support

### âœ… Role-Based UI
- Different views based on role
- Hidden actions for unauthorized users
- Role-specific dashboards
- Permission-based navigation

### âœ… Modern Admin Panel
- Color-coded sections
- Emoji icons for clarity
- Custom status badges
- Interactive dashboard
- Responsive design

---

## ğŸš€ Technology Stack

### Backend Framework
- **Node.js** v24.4.1
- **Express.js** 4.x
- **MongoDB** with Mongoose

### Admin Panel
- **AdminJS** 6.8.7
- **@adminjs/express** 5.1.0
- **@adminjs/mongoose** 3.0.1
- **@adminjs/design-system** (for UI components)

### File Storage
- **Cloudinary** (cloud storage)
- **Multer** (file upload middleware)
- **multer-storage-cloudinary** (integration)

### Authentication & Security
- **JWT** (JSON Web Tokens)
- **bcryptjs** (password hashing)
- **express-session** (session management)
- **cors** (Cross-Origin Resource Sharing)

### Utilities
- **dotenv** (environment variables)
- **express-async-handler** (async error handling)

---

## ğŸ“¦ Database Schema Overview

### Collections (16 total)

1. **users** - Admin system users
2. **blogs** - Blog posts with rich content
3. **stories** - Success stories & case studies
4. **events** - Events organized by year/month
5. **videos** - Video content library
6. **awards** - Awards & recognitions
7. **publications** - Reports & publications
8. **faqs** - Frequently asked questions
9. **teachers** - Team members & staff
10. **contacts** - Contact form submissions
11. **donors** - Donor information & tracking
12. **volunteers** - Volunteer applications
13. **internships** - Internship applications
14. **clubregistrations** - Club registration requests
15. **siteconfigs** - Site configuration settings
16. **csrsubmissions** - CSR proposals

### Common Fields Across Models
- `status` - Workflow status
- `createdBy` - User who created
- `reviewedBy` - User who reviewed
- `reviewedAt` - Review timestamp
- `createdAt` - Creation timestamp
- `updatedAt` - Last update timestamp

---

## ğŸ”„ API Response Format

### Success Response
```json
{
  "success": true,
  "data": { ... },
  "message": "Operation successful"
}
```

### Error Response
```json
{
  "success": false,
  "error": "Error message",
  "stack": "..." // Only in development
}
```

### Paginated Response
```json
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 150,
    "pages": 8
  }
}
```

---

## ğŸ¨ Color Scheme

### Primary Colors
- **Orange** `#FF7A42` - Primary brand color
- **Blue** `#4A90E2` - Accent color
- **Green** `#2ECC71` - Success states
- **Red** `#E74C3C` - Error/danger states
- **Yellow** `#F39C12` - Warning states

### Status Colors
- **Pending** - Yellow/Warning
- **Approved** - Green/Success
- **Rejected** - Red/Danger
- **Archived** - Gray/Default
- **Draft** - Blue/Info
- **Published** - Green/Success

---

## ğŸ”§ Environment Variables

```env
# Server
PORT=5000
NODE_ENV=development

# Database
MONGODB_URI=mongodb://localhost:27017/ngo-db

# JWT
JWT_SECRET=your_super_secret_key_here
JWT_EXPIRE=30d

# AdminJS
ADMINJS_COOKIE_SECRET=your_cookie_secret

# Cloudinary
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
```

---

## ğŸ§ª Testing Strategy

### Manual Testing Checklist

**Authentication:**
- [ ] Login with Super Admin
- [ ] Login with Admin
- [ ] Login with Manager
- [ ] Login with Editor
- [ ] Test invalid credentials
- [ ] Test session expiry

**CRUD Operations (Each Resource):**
- [ ] Create new record
- [ ] View list with filters
- [ ] View single record
- [ ] Update record
- [ ] Delete record
- [ ] Test validation errors

**Approval Workflow:**
- [ ] Approve pending item
- [ ] Reject pending item
- [ ] Archive approved item
- [ ] Unarchive item
- [ ] Bulk approve multiple items
- [ ] Bulk archive multiple items

**File Upload:**
- [ ] Upload logo
- [ ] Upload hero images (multiple)
- [ ] Upload event images
- [ ] Upload video
- [ ] Upload document (CSR)
- [ ] Test file size limits
- [ ] Test file type validation

**Role Permissions:**
- [ ] Editor cannot delete
- [ ] Editor cannot approve
- [ ] Manager cannot access users
- [ ] Manager can approve registrations
- [ ] Admin can access everything except system
- [ ] Super Admin has full access

---

## ğŸš€ Deployment Checklist

- [ ] Set `NODE_ENV=production`
- [ ] Update MongoDB connection string
- [ ] Configure Cloudinary credentials
- [ ] Generate strong JWT secret
- [ ] Enable HTTPS
- [ ] Set up rate limiting
- [ ] Configure CORS for production domains
- [ ] Set up backup strategy
- [ ] Configure logging service
- [ ] Set up monitoring (PM2, New Relic)
- [ ] Create production admin users
- [ ] Test all critical workflows

---

## ğŸ“ˆ Future Enhancements

### Phase 2 Features
- [ ] Email notifications (approval, rejection)
- [ ] SMS notifications for critical actions
- [ ] Advanced analytics dashboard
- [ ] Export data (CSV, Excel, PDF)
- [ ] Two-factor authentication (2FA)
- [ ] Activity logs & audit trail
- [ ] Scheduled reports
- [ ] API rate limiting per user
- [ ] Webhook integrations
- [ ] Mobile app API

### Phase 3 Features
- [ ] Multi-language support
- [ ] Advanced search with Elasticsearch
- [ ] Real-time updates (Socket.io)
- [ ] Comment system for reviews
- [ ] Automated backup system
- [ ] Version control for content
- [ ] Draft auto-save
- [ ] Collaborative editing

---

## ğŸ“ Support & Maintenance

### Regular Maintenance Tasks
- Weekly database backups
- Monthly security updates
- Quarterly dependency updates
- Annual performance audit

### Monitoring Metrics
- API response times
- Error rates
- Database query performance
- File upload success rate
- User session duration
- Role-based usage patterns

---

**Architecture Version:** 1.0.0  
**Last Updated:** December 2025  
**Maintainer:** Sabri Helpage Development Team
