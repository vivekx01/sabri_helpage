# Backend API Testing Guide

## Server Status: ✅ STABLE & RUNNING

### Start Server
```powershell
cd c:\Users\hp220\Sabri-Helpage_\backend
npm run dev
```

### Create Super Admin (First Time)
```powershell
npm run create-admin
# Email: superadmin@helpage.org
# Password: admin123
```

## Public Routes (No Auth Required)

### Health Check
```powershell
Invoke-RestMethod "http://localhost:5000/"
```

### Get All Resources
```powershell
# Blogs
Invoke-RestMethod "http://localhost:5000/api/blogs"

# Stories
Invoke-RestMethod "http://localhost:5000/api/stories"

# Events
Invoke-RestMethod "http://localhost:5000/api/events"

# Videos
Invoke-RestMethod "http://localhost:5000/api/videos"

# Awards
Invoke-RestMethod "http://localhost:5000/api/awards"

# Publications
Invoke-RestMethod "http://localhost:5000/api/publications"

# FAQs
Invoke-RestMethod "http://localhost:5000/api/faqs"

# Site Config
Invoke-RestMethod "http://localhost:5000/api/config"
```

## Auth Routes

### Login
```powershell
$loginBody = @{ 
    email="superadmin@helpage.org"
    password="admin123" 
} | ConvertTo-Json

$login = Invoke-RestMethod -Uri "http://localhost:5000/api/auth/login" `
    -Method POST `
    -Body $loginBody `
    -ContentType "application/json"

$token = $login.data.token
```

### Get Profile
```powershell
$headers = @{ Authorization = "Bearer $token" }
Invoke-RestMethod -Uri "http://localhost:5000/api/auth/me" -Headers $headers
```

## Protected Routes (Auth Required)

### Users Management (Admin/Super-Admin only)
```powershell
$headers = @{ Authorization = "Bearer $token" }

# Get all users
Invoke-RestMethod -Uri "http://localhost:5000/api/users" -Headers $headers

# Get user by ID
Invoke-RestMethod -Uri "http://localhost:5000/api/users/{id}" -Headers $headers
```

### Create Content (Editor/Manager/Admin)

#### Create Blog
```powershell
$blogBody = @{
    title = "My Blog Title"
    content = "Blog content here"
    author = "Author Name"
    tags = @("tag1", "tag2")
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:5000/api/blogs" `
    -Method POST `
    -Body $blogBody `
    -ContentType "application/json" `
    -Headers $headers
```

#### Create Event
```powershell
$eventBody = @{
    title = "Event Title"
    description = "Event description"
    year = 2025
    month = 12
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:5000/api/events" `
    -Method POST `
    -Body $eventBody `
    -ContentType "application/json" `
    -Headers $headers
```

#### Create FAQ
```powershell
$faqBody = @{
    question = "Your question?"
    answer = "The answer"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:5000/api/faqs" `
    -Method POST `
    -Body $faqBody `
    -ContentType "application/json" `
    -Headers $headers
```

## Quick Test Suite
```powershell
# Run all tests at once
cd c:\Users\hp220\Sabri-Helpage_\backend

# Public routes
$h = Invoke-RestMethod "http://localhost:5000/"
$blogs = Invoke-RestMethod "http://localhost:5000/api/blogs"
$events = Invoke-RestMethod "http://localhost:5000/api/events"
Write-Host "✅ Public routes OK - Blogs: $($blogs.data.Count) | Events: $($events.data.Count)"

# Auth flow
$loginBody = @{ email="superadmin@helpage.org"; password="admin123" } | ConvertTo-Json
$login = Invoke-RestMethod -Uri "http://localhost:5000/api/auth/login" -Method POST -Body $loginBody -ContentType "application/json"
$token = $login.data.token
$headers = @{ Authorization = "Bearer $token" }
$me = Invoke-RestMethod -Uri "http://localhost:5000/api/auth/me" -Headers $headers
Write-Host "✅ Auth OK - User: $($me.data.name) ($($me.data.role))"

# Protected routes
$users = Invoke-RestMethod -Uri "http://localhost:5000/api/users" -Headers $headers
Write-Host "✅ Protected routes OK - Users: $($users.data.Count)"
```

## All Endpoints Summary

### Public GET
- `/` - Health check
- `/api/blogs` - All blogs
- `/api/stories` - All stories
- `/api/events` - All events
- `/api/videos` - All videos
- `/api/awards` - All awards
- `/api/publications` - All publications
- `/api/faqs` - All FAQs
- `/api/config` - Site configuration

### Auth
- `POST /api/auth/login` - Login
- `POST /api/auth/register` - Register (super-admin only)
- `GET /api/auth/me` - Get profile (protected)

### Users (Admin only)
- `GET /api/users` - Get all users
- `GET /api/users/:id` - Get user by ID
- `PUT /api/users/:id` - Update user
- `DELETE /api/users/:id` - Delete user (super-admin only)

### Protected CRUD (all resources follow same pattern)
- `GET /api/{resource}` - Public
- `GET /api/{resource}/:id` - Public
- `POST /api/{resource}` - Protected (editor+)
- `PUT /api/{resource}/:id` - Protected (editor+)
- `DELETE /api/{resource}/:id` - Protected (admin+)

## Role Hierarchy
1. **super-admin** - Full access (create admins, delete users)
2. **admin** - Manage users, all content
3. **manager** - Manage content, view users
4. **editor** - Create/edit content

## Server Health: ✅ STABLE
- MongoDB: Connected
- Port: 5000
- All routes: Tested & Working
- Auth: JWT tokens working
- CRUD: Create/Read/Update/Delete all functional
